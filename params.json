{
  "name": "Os-x-security-and-privacy-guide",
  "tagline": "",
  "body": "This is a collection of thoughts on securing a modern Apple Mac computer using OS X 10.11 \"El Capitan\", as well as steps to improving online privacy.\r\n\r\nThis guide is targeted to “power users” who wish to adopt enterprise-standard security, but is also suitable for novice users with an interest in improving their privacy and security on a Mac.\r\n\r\nThere is no security silver bullet. A system is only as secure as its administrator is capable of making it.\r\n\r\nI am **not** responsible if you break a Mac by following any of these steps.\r\n\r\nIf you wish to make a correction or improvement, please send a pull request or [open an issue](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues).\r\n\r\n- [Basics](#basics)\r\n- [Preparing OS X](#preparing-os-x)\r\n- [Installing OS X](#installing-os-x)\r\n    - [Recovery partition](#recovery-partition)\r\n- [First boot](#first-boot)\r\n- [Full disk encryption](#full-disk-encryption)\r\n- [Firmware password](#firmware-password)\r\n- [Firewall](#firewall)\r\n    - [Application layer firewall](#application-layer-firewall)\r\n    - [Third party firewalls](#third-party-firewalls)\r\n    - [Kernel level packet filtering](#kernel-level-packet-filtering)\r\n- [Services](#services)\r\n- [Spotlight Suggestions](#spotlight-suggestions)\r\n- [Homebrew](#homebrew)\r\n- [DNS](#dns)\r\n    - [Hosts file](#hosts-file)\r\n    - [dnsmasq](#dnsmasq)\r\n    - [dnscrypt](#dnscrypt)\r\n- [Captive portal](#captive-portal)\r\n- [Certificate authorities](#certificate-authorities)\r\n- [OpenSSL](#openssl)\r\n- [Curl](#curl)\r\n- [HTTP](#http)\r\n- [Web browsing](#web-browsing)\r\n- [Plugins](#plugins)\r\n- [PGP/GPG](#pgpgpg)\r\n- [OTR](#otr)\r\n- [Tor](#tor)\r\n- [VPN](#vpn)\r\n- [Viruses and malware](#viruses-and-malware)\r\n- [System Integrity Protection](#system-integrity-protection)\r\n- [Gatekeeper and Xprotect](#gatekeeper-and-xprotect)\r\n- [Passwords](#passwords)\r\n- [Backup](#backup)\r\n- [Wi-Fi](#wi-fi)\r\n- [SSH](#ssh)\r\n- [Physical access](#physical-access)\r\n- [System monitoring](#system-monitoring)\r\n    - [Open source monitoring tools](#open-source-monitoring-tools)\r\n    - [OpenBSM audit](#openbsm-audit)\r\n    - [DTrace](#dtrace)\r\n    - [Network](#network)\r\n- [Miscellaneous](#miscellaneous)\r\n- [Additional resources](#additional-resources)\r\n\r\n## Basics\r\nThe standard best security practices apply.\r\n\r\n* Create a threat model\r\n\t* What are you trying to protect and from whom? Is your adversary a [three letter agency](https://theintercept.com/document/2015/03/10/strawhorse-attacking-macos-ios-software-development-kit/) (if so, you may want to consider using [OpenBSD](http://www.openbsd.org/) instead), a nosy eavesdropper on the network, or determined [apt](https://en.wikipedia.org/wiki/Advanced_persistent_threat) orchestrating a campaign against you?\r\n\t* Study and recognize threats and how to reduce attack surface.\r\n\r\n* Keep the system up to date\r\n\t* Patch, patch, patch your system and software.\r\n\t* Subscribe to announcement mailing lists (e.g., [Apple security-announce](https://lists.apple.com/mailman/listinfo/security-announce)) for programs you use often.\r\n\r\n* Encrypt sensitive data\r\n\t* In addition to full disk encryption, create one or many encrypted containers to store passwords, keys and personal documents.\r\n\t* This will mitigate damage in case of compromise and data exfiltration.\r\n\r\n* Frequent backups\r\n\t* Create regular backups of your data and be ready to reimage in case of compromise.\r\n\t* Always encrypt before copying backups to external media or the \"cloud\".\r\n\r\n* Click carefully\r\n\t* Ultimately, the security of a system can be reduced to its administrator.\r\n\t* Care should be taken when installing new software. Always prefer [free](https://www.gnu.org/philosophy/free-sw.en.html) and open source software ([which OS X is not](https://superuser.com/questions/19492/is-mac-os-x-open-source)).\r\n\r\n## Preparing OS X\r\nThere are several ways to install a fresh copy of OS X.\r\n\r\nThe simplest way is to boot into [Recovery Mode](https://support.apple.com/en-us/HT201314) by holding `Command` and `R` keys at boot. A system image can be downloaded and applied directly from Apple. However, this way exposes the computer's serial number and other identifying information to Apple over plain **HTTP**.\r\n\r\nAnother way is to download **OS X El Capitan 10.11.2** from the [App Store](https://itunes.apple.com/us/app/os-x-el-capitan/id1018109117) or some other place and create a custom, installable system image.\r\n\r\nThe application is [code signed](https://developer.apple.com/library/mac/documentation/Security/Conceptual/CodeSigningGuide/Procedures/Procedures.html#//apple_ref/doc/uid/TP40005929-CH4-SW6), which should be verified to make sure you received a legitimate copy.\r\n\r\n    $ codesign -dvv /Applications/Install\\ OS\\ X\\ El\\ Capitan.app\r\n    Executable=/Applications/Install OS X El Capitan.app/Contents/MacOS/InstallAssistant\r\n    Identifier=com.apple.InstallAssistant.ElCapitan\r\n    Format=bundle with Mach-O thin (x86_64)\r\n    CodeDirectory v=20200 size=280 flags=0x200(kill) hashes=4+5 location=embedded\r\n    Signature size=4169\r\n    Authority=Apple Mac OS Application Signing\r\n    Authority=Apple Worldwide Developer Relations Certification Authority\r\n    Authority=Apple Root CA\r\n    Info.plist entries=31\r\n    TeamIdentifier=K36BKF7T3D\r\n    Sealed Resources version=2 rules=8 files=151\r\n    Internal requirements count=1 size=124\r\n\r\nOS X installers can be made with the `createinstallmedia` utility included in `Install OS X El Capitan.app/Contents/Resources/`. See [Create a bootable installer for OS X Yosemite](https://support.apple.com/en-us/HT201372), or run the utility without arguments to see how it works.\r\n\r\nIf you'd like to do it the **manual** way, you will need to find the file `InstallESD.dmg`, which is inside `Install OS X El Capitan.app`.\r\n\r\nRight click, select **Show Package Contents** and navigate to **Contents > SharedSupport** to find `InstallESD.DMG`.\r\n\r\nYou can verify the following cryptographic hashes to ensure you have the same, authentic copy by using a command like `shasum -a256 InstallESD.dmg` and so on.\r\n\r\nYou can also Google these hashes to ensure your copy is genuine and has not been tampered with. See `InstallESD_Hashes.csv` in this repository for previous versions.\r\n\r\n    InstallESD.dmg (Build 15D21)\r\n\r\n    SHA-256:   bc46b9b02e69546e1446e131d4a8d3b0203a6bbad73a003749571da85f51a613\r\n    SHA-1:     e4311d93127d0668372b32e5342f3b455b6bc9bd\r\n\r\nMount and install the operating system to a **temporary image**, or use the GUI app [MagerValp/AutoDMG](https://github.com/MagerValp/AutoDMG).\r\n\r\n    hdiutil attach -noverify -mountpoint /tmp/installesd ./InstallESD.dmg\r\n\r\n    hdiutil create -size 32g -type SPARSE -fs HFS+J -volname \"OS X\" -uid 0 -gid 80 -mode 1775 /tmp/output.sparseimage\r\n\r\n    hdiutil attach -noverify -mountpoint /tmp/os -owners on /tmp/output.sparseimage\r\n\r\n    sudo installer -pkg /tmp/installesd/Packages/OSInstall.mpkg -tgt /tmp/os\r\n\r\nThis part will take a while, so just be patient. You can `tail -F /var/log/install.log` to check progress.\r\n\r\nOptionally, install any other packages to the image, such as [Wireshark](https://www.wireshark.org/download.html).\r\n\r\n    hdiutil mount Wireshark\\ 2.0.1\\ Intel\\ 64.dmg\r\n\r\n    sudo installer -pkg /Volumes/Wireshark/Wireshark\\ 2.0.1\\ Intel\\ 64.pkg -tgt /tmp/os\r\n\r\n    hdiutil unmount /Volumes/Wireshark\r\n\r\nSee [MagerValp/AutoDMG/wiki/Packages-Suitable-for-Deployment](https://github.com/MagerValp/AutoDMG/wiki/Packages-Suitable-for-Deployment) for caveats and check out [chilcote/outset](https://github.com/chilcote/outset) to instead processes packages and scripts at first boot.\r\n\r\nWhen you're done, detach, convert and verify the image.\r\n\r\n    hdiutil detach /tmp/os\r\n\r\n    hdiutil detach /tmp/installesd\r\n\r\n    hdiutil convert -format UDZO /tmp/output.sparseimage -o elcap.dmg\r\n\r\n    asr imagescan --source elcap.dmg\r\n\r\nNow, `elcap.dmg` is ready to be applied to one or multiple Macs. You can further customize the image to include premade users, applications and preferences to your liking.\r\n\r\n## Installing OS X\r\n\r\nOne way to install the OS X image is using another Mac in [Target Disk Mode](https://support.apple.com/en-us/HT201462).\r\n\r\nIf you don't have another Mac, create a bootable USB drive from the El Capitan application bundle, and boot the Mac you wish to image to it by holding the *Option* key at boot.\r\n\r\nAlternatively, you could also create a second partition on your existing Mac and use that.\r\n\r\nIf you don't have an external drive or USB stick to use, it's possible to create a small partition with **Disk Utility** and use that. There are several guides online on how to do this.\r\n\r\nTo use **Target Disk Mode**, boot up the Mac you wish to image while holding `T` and connect it to another using Firewire, Thunderbolt or USB-C.\r\n\r\nRun `diskutil list` to identify the connected disk, usually `/dev/disk2`\r\n\r\n**Erase** the disk to Journaled HFS+\r\n\r\n    diskutil unmountDisk /dev/disk2\r\n    diskutil partitionDisk /dev/disk2 1 JHFS+ OSX 100%\r\n\r\n**Restore** the image to the new volume\r\n\r\n    sudo asr restore \\\r\n      --source elcap.dmg \\\r\n      --target /Volumes/OSX \\\r\n      --erase --noverify \\\r\n      --buffersize 4m\r\n\r\nAlternatively, open the **Disk Utility** application, erase the connected Mac's disk, then drag `elcap.dmg` in to restore it to the new partition.\r\n\r\nIf you've followed these steps correctly, the target Mac should now have a new install of OS X.\r\n\r\nIf you want to transfer any files, copy them to a folder like `/Users/Shared` on the mounted disk image, e.g. `cp Xcode_7.0.dmg /Volumes/OS\\ X/Users/Shared`\r\n\r\n#### Recovery partition\r\n\r\nWe're not done yet! Unless you have built the image with [AutoDMG](https://github.com/MagerValp/AutoDMG), or installed OS X to a second partition on your Mac, you will need to create a recovery partition in order to use Filevault full disk encryption. You can do so using [MagerValp/Create-Recovery-Partition-Installer](https://github.com/MagerValp/Create-Recovery-Partition-Installer) or by following these steps.\r\n\r\nDownload [RecoveryHDUpdate.dmg](https://support.apple.com/downloads/DL1464/en_US/RecoveryHDUpdate.dmg)\r\n\r\n    RecoveryHDUpdate.dmg\r\n\r\n    SHA-256: f6a4f8ac25eaa6163aa33ac46d40f223f40e58ec0b6b9bf6ad96bdbfc771e12c\r\n    SHA-1:   1ac3b7059ae0fcb2877d22375121d4e6920ae5ba\r\n\r\nAttach and expand the installation, then run it\r\n\r\n    hdiutil attach RecoveryHDUpdate.dmg\r\n\r\n    pkgutil --expand /Volumes/Mac\\ OS\\ X\\ Lion\\ Recovery\\ HD\\ Update/RecoveryHDUpdate.pkg /tmp/recovery\r\n\r\n    hdiutil attach /tmp/recovery/RecoveryHDUpdate.pkg/RecoveryHDMeta.dmg\r\n\r\n    /tmp/recovery/RecoveryHDUpdate.pkg/Scripts/Tools/dmtest ensureRecoveryPartition /Volumes/OS\\ X/ /Volumes/Recovery\\ HD\\ Update/BaseSystem.dmg 0 0 /Volumes/Recovery\\ HD\\ Update/BaseSystem.chunklist\r\n\r\nWhere `/Volumes/OS\\ X` is the path to the target disk mode booted Mac.\r\n\r\nThis will take several minutes.\r\n\r\nRun `diskutil list` again to make sure **Recovery HD** now exists.\r\n\r\nOnce you're done, eject the disk with `hdiutil unmount /Volumes/OS\\ X` and power down the connected Mac.\r\n\r\n## First boot\r\nOn first boot, hold `Command` `Option` `P` and `R` keys to [clear NVRAM](https://support.apple.com/en-us/HT204063).\r\n\r\nWait for the loud, obnoxious gong and keep holding while the Mac reboots once.\r\n\r\nWhen OS X first starts, you'll be greeted by **Setup Assistant**.\r\n\r\nDo not connect to networking yet; skip that part of the setup for now.\r\n\r\nWhen creating your account, use a [strong password](http://www.explainxkcd.com/wiki/index.php/936:_Password_Strength) without a hint.\r\n\r\nDon't use your real name for your account as it'll show up as *So-and-so's Macbook* through sharing services to local networks.\r\n\r\n## Full disk encryption\r\n[Filevault](https://en.wikipedia.org/wiki/FileVault) provides full disk (technically, full _volume_) encryption on OS X.\r\n\r\nFilevault encryption will protect data at rest and prevent someone with physical access from stealing data or tampering with your Mac.\r\n\r\nWith much crypto [happening in hardware](https://software.intel.com/en-us/articles/intel-advanced-encryption-standard-aes-instructions-set/), the performance penalty for Filevault is not noticeable.\r\n\r\nThe security of Filevault 2 greatly depends on the pseudo random number generator (**PRNG**).\r\n\r\n> The random device implements the Yarrow pseudo random number generator algorithm and maintains its entropy pool.  Additional entropy is fed to the generator regularly by the SecurityServer daemon from random jitter measurements of the kernel.\r\n>\r\n> SecurityServer is also responsible for periodically saving some entropy to disk and reloading it during startup to provide entropy in early system operation.\r\n\r\nSee `man 4 random` for more information.\r\n\r\nThe PRNG can be manually seeded with entropy by writing to /dev/random **before** enabling Filevault 2. This can be done by simply using the Mac for a little while before activating Filevault 2.\r\n\r\nEnable Filevault with `sudo fdesetup enable` or using **System Preferences** and reboot.\r\n\r\nIf you can remember your password, there's no reason to save the **recovery key**. However, your encrypted data will be lost forever if you can't remember the password or recovery key.\r\n\r\nIf you want to know more about how Filevault 2 works, see the paper [Infiltrate the Vault: Security Analysis and Decryption of Lion Full Disk Encryption](https://eprint.iacr.org/2012/374.pdf) [pdf]\r\n\r\nand [IEEE Std 1619-2007 “The XTS-AES Tweakable Block Cipher”](http://libeccio.di.unisa.it/Crypto14/Lab/p1619.pdf) [pdf]\r\n\r\nYou may wish to enforce **hibernation** and evict Filevault keys from memory instead of traditional sleep to memory.\r\n\r\n    sudo pmset -a destroyfvkeyonstandby 1\r\n    sudo pmset -a hibernatemode 25\r\n\r\n> All computers have firmware of some type—EFI, BIOS—to help in the discovery of hardware components and ultimately to properly bootstrap the computer using the desired OS instance. In the case of Apple hardware and the use of EFI, Apple stores relevant information within EFI to aid in the functionality of OS X. For example, the FileVault key is stored in EFI to transparently come out of standby mode.\r\n\r\n> Organizations especially sensitive to a high-attack environment, or potentially exposed to full device access when the device is in standby mode, should mitigate this risk by destroying the FileVault key in firmware. Doing so doesn’t destroy the use of FileVault, but simply requires the user to enter the password in order for the system to come out of standby mode.\r\n\r\nFor more information, see [Best Practices for\r\nDeploying FileVault 2](http://training.apple.com/pdf/WP_FileVault2.pdf) [pdf]\r\n\r\nand paper [Lest We Remember: Cold Boot Attacks on Encryption Keys](https://www.usenix.org/legacy/event/sec08/tech/full_papers/halderman/halderman.pdf) [pdf]\r\n\r\n## Firmware password\r\n\r\nSetting a firmware password in OS X prevents your Mac from starting up from any device other than your startup disk. [It can also be helpful if your laptop is stolen](https://www.ftc.gov/news-events/blogs/techftc/2015/08/virtues-strong-enduser-device-controls), as the only way to reset the firmware password is through an Apple Store ([or is it?](https://reverse.put.as/2015/05/29/the-empire-strikes-back-apple-how-your-mac-firmware-security-is-completely-broken/)).\r\n\r\n1. Start up holding the `Command` and `R` keys to boot from **OS X Recovery** mode.\r\n\r\n3. When the Recovery window appears, choose **Firmware Password Utility** from the Utilities menu.\r\n\r\n4. In the Firmware Utility window that appears, select **Turn On Firmware Password**.\r\n\r\n5. Enter a new password, then enter the same password in the Verify field.\r\n\r\n6. Select Set Password.\r\n\r\n7. Select Quit Firmware Utility to close the Firmware Password Utility.\r\n\r\n8. Select the Apple menu and choose Restart or Shutdown.\r\n\r\nThe firmware password will activate at next boot. To validate the password, hold `alt` during boot - you should be prompted to enter the password.\r\n\r\n## Firewall\r\nBefore connecting to the Internet, it's a good idea to first configure a firewall.\r\n\r\nThere are several types of firewall for OS X.\r\n\r\n#### Application layer firewall\r\nBuilt-in, basic firewall which blocks **incoming** connections only.\r\n\r\nNote, this firewall does not have the ability to monitor, nor block **outgoing** connections.\r\n\r\nIt can be controlled by the **Firewall** tab of **Security & Privacy** in **System Preferences**, or with the following commands.\r\n\r\nEnable the firewall:\r\n\r\n    sudo defaults write /Library/Preferences/com.apple.alf globalstate -bool true\r\n\r\nEnable logging:\r\n\r\n    sudo defaults write /Library/Preferences/com.apple.alf loggingenabled -bool true\r\n\r\nYou may also wish to enable stealth mode:\r\n\r\n    sudo defaults write /Library/Preferences/com.apple.alf stealthenabled -bool true\r\n\r\n> Computer hackers scan networks so they can attempt to identify computers to attack. You can prevent your computer from responding to some of these scans by using **stealth mode**. When stealth mode is enabled, your computer does not respond to ICMP ping requests, and does not answer to connection attempts from a closed TCP or UDP port. This makes it more difficult for attackers to find your computer.\r\n\r\nFinally, you may wish to disable feature, *Automatically allow signed software to receive incoming connections*.\r\n\r\n    sudo defaults write /Library/Preferences/com.apple.alf allowsignedenabled -bool false\r\n\r\n> Applications that are signed by a valid certificate authority are automatically added to the list of allowed apps, rather than prompting the user to authorize them. Apps included in OS X are signed by Apple and are allowed to receive incoming connections when this setting is enabled. For example, since iTunes is already signed by Apple, it is automatically allowed to receive incoming connections through the firewall.\r\n>\r\n> If you run an unsigned app that is not listed in the firewall list, a dialog appears with options to Allow or Deny connections for the app. If you choose Allow, OS X signs the application and automatically adds it to the firewall list. If you choose Deny, OS X adds it to the list but denies incoming connections intended for this app.\r\n\r\n#### Third party firewalls\r\nPrograms such as [Little Snitch](https://www.obdev.at/products/littlesnitch/index.html), [Hands Off](https://www.oneperiodic.com/products/handsoff/) and [Radio Silence](http://radiosilenceapp.com/) provide a good balance of usability and security.\r\n\r\n<img width=\"349\" alt=\"Example of Little Snitch monitored session\" src=\"https://cloud.githubusercontent.com/assets/12475110/10596588/c0eed3c0-76b3-11e5-95b8-9ce7d51b3d82.png\">\r\n\r\n*Example of Little Snitch-monitored session*\r\n\r\nThese programs are capable of monitoring and blocking **incoming** and **outgoing** network connections. However, they may require the use of a closed source [kernel extension](https://developer.apple.com/library/mac/documentation/Darwin/Conceptual/KernelProgramming/Extend/Extend.html).\r\n\r\nIf the number of choices of allowing/blocking network connections is overwhelming, use **Silent Mode** with connections allowed, then periodically check your settings to gain understanding of what various applications are doing.\r\n\r\nIt is worth noting that these firewalls can be bypassed by programs running as **root** or through [OS vulnerabilities](https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf) [pdf], but they are still worth having - just don't expect absolute protection.\r\n\r\n#### Kernel level packet filtering\r\nA highly customizable, powerful, but also most complicated firewall exists in the kernel. It can be controlled with `pfctl` and various configuration files.\r\n\r\npf also be controlled with a GUI application such as [IceFloor](http://www.hanynet.com/icefloor/) or [Murus](http://www.murusfirewall.com/).\r\n\r\nThere are many books and articles on the subject of pf firewall. Here's is just one example of blocking traffic by IP address.\r\n\r\nPut the following into a file called `pf.rules`\r\n\r\n    set block-policy drop\r\n    set fingerprints \"/etc/pf.os\"\r\n    set ruleset-optimization basic\r\n    set skip on lo0\r\n    scrub in all no-df\r\n    table <blocklist> persist\r\n    block in log\r\n    block in log quick from no-route to any\r\n    pass out proto tcp from any to any keep state\r\n    pass out proto udp from any to any keep state\r\n    block log on en0 from {<blocklist>} to any\r\n\r\nUse the following commands\r\n\r\n* `sudo pfctl -e -f pf.rules` to enable the firewall\r\n* `sudo pfctl -d` to disable the firewall\r\n* `sudo pfctl -t blocklist -T add 1.2.3.4` to add hosts to a blocklist\r\n* `sudo pfctl -t blocklist -T show` to view the blocklist\r\n* `sudo ifconfig pflog0 create` to create an interface for logging\r\n* `sudo tcpdump -ni pflog0` to dump the packets\r\n\r\nUnless you're already familiar with packet filtering, spending too much time configuring pf is not recommended. It is also probably unnecessary if your Mac is behind a [NAT](https://www.grc.com/nat/nat.htm) on a secured home network, for example.\r\n\r\nFor an example of using pf to audit \"phone home\" behavior of user and system-level processes, see [fix-macosx/net-monitor](https://github.com/fix-macosx/net-monitor).\r\n\r\n## Services\r\nBefore you connect to the Internet, you may wish to disable some system services, which use up resources or phone home to Apple.\r\n\r\nSee [fix-macosx/yosemite-phone-home](https://github.com/fix-macosx/yosemite-phone-home) and [l1k/osxparanoia](https://github.com/l1k/osxparanoia)\r\n\r\nServices on OS X are managed by **launchd**. See <http://launchd.info/>, as well as [Apple's Daemons and Services Programming Guide](https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html) and [Technical Note TN2083](https://developer.apple.com/library/mac/technotes/tn2083/_index.html)\r\n\r\nYou can also run [KnockKnock](https://github.com/synack/knockknock) that shows more information about startup items.\r\n\r\n* Use `launchctl list` to view running user agents\r\n* Use `sudo launchctl list` to view running system daemons\r\n* Specify the service name to examine it, e.g. `launchctl list com.apple.Maps.mapspushd`\r\n* Use `defaults read` to examine job plists in `/System/Library/LaunchDaemons` and `/System/Library/LaunchAgents`\r\n* Use `man`, `strings` and Google to learn about what the agent/daemon runs\r\n\r\nFor example, to learn what a system launch daemon or agent does, start with\r\n\r\n\tdefaults read /System/Library/LaunchDaemons/com.apple.apsd.plist\r\n\r\nLook at the `Program` or `ProgramArguments` section to see which binary is run, in this case `apsd`. To find more information about that, look at the man page with `man apsd`\r\n\r\nIf you're not interested in Apple Push Notifications, disable the service\r\n\r\n\tsudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.apsd.plist\r\n\r\n**Note** Unloading services may break usability of some applications. Read the manual pages and use Google to make sure you understand what you're doing first.\r\n\r\nBe careful about disabling any system daemons you don't understand, as it may render your system unbootable. If you break your Mac, use [single user mode](https://support.apple.com/en-us/HT201573) to fix it.\r\n\r\nUse [Console](https://en.wikipedia.org/wiki/Console_(OS_X)) and [Activity Monitor](https://support.apple.com/en-us/HT201464) applications if you notice your Mac heating up, feeling slugging, or generally misbehaving, as it may have resulted from your tinkering.\r\n\r\nTo view currently disabled services,\r\n\r\n    find /var/db/com.apple.xpc.launchd/ -type f -print -exec defaults read {} \\; 2>/dev/null\r\n\r\nAnnotated lists of launch daemons and agents, the respective program executed, and the programs' hash sums are included in this repository.\r\n\r\nYou may run the `read_launch_plists.py` script and `diff` output to check for any discrepancies on your system, e.g.:\r\n\r\n    diff <(python read_launch_plists.py) <(cat 14F27_launchd.csv)\r\n\r\nSee also [cirrusj.github.io/Yosemite-Stop-Launch](http://cirrusj.github.io/Yosemite-Stop-Launch/) for descriptions of services.\r\n\r\n## Spotlight Suggestions\r\nDisable “Spotlight Suggestions” in both the Spotlight preferences and Safari's Search preferences to avoid your search queries being sent to Apple.\r\n\r\nAlso disable \"Bing Web Searches\" in the Spotlight preferences to avoid your search queries being sent to Microsoft.\r\n\r\nSee <https://fix-macosx.com/> for detailed instructions.\r\n\r\n> If you've upgraded to Mac OS X Yosemite (10.10) and you're using the default settings, each time you start typing in Spotlight (to open an application or search for a file on your computer), your local search terms and location are sent to Apple and third parties (including Microsoft).\r\n\r\nSpeaking of Microsoft, you may want to see <https://fix10.isleaked.com/> just for fun.\r\n\r\n## Homebrew\r\nConsider using [Homebrew](http://brew.sh/) to make software installations easier and to update userland tools (see [Apple’s great GPL purge](http://meta.ath0.com/2012/02/05/apples-great-gpl-purge/)).\r\n\r\nIf you have not already installed Xcode or Command Line Tools, run `xcode-select --install` and a prompt should appear to download and install CLI Tools.\r\n\r\nHomebrew can be easily installed with\r\n\r\n    ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\r\n\r\nor have a look at [homebrew/Installation.md](https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/Installation.md#installation) for other installation options.\r\n\r\nHomebrew uses SSL/TLS to talk with github and verifies checksums of downloaded packages, so it's [fairly secure](https://github.com/Homebrew/homebrew/issues/18036).\r\n\r\nAlternatively, you could download, compile and install software directly from their respective open source repositories.\r\n\r\nRemember to periodically run `brew update` and `brew upgrade` on trusted, secure networks to install software updates.\r\n\r\n## DNS\r\nHere are a few ways to improve your security and privacy with DNS.\r\n\r\n#### Hosts file\r\nUse the [hosts file](https://en.wikipedia.org/wiki/Hosts_(file)) to block known malware, advertising or otherwise unwanted domains.\r\n\r\nEdit the hosts file as root, for example with `sudo vi /etc/hosts`. The hosts file can also be managed with the GUI app [2ndalpha/gasmask](https://github.com/2ndalpha/gasmask).\r\n\r\nTo block a domain, just add `0 facebook.com` (`0` means `0.0.0.0`, a null route)\r\n\r\nThere are many lists of domains available online which you can paste in, just make sure each line starts with `0` or `127.0.0.1`, and the line `127.0.0.1 localhost` is included.\r\n\r\nFor hosts lists, see [someonewhocares.org](http://someonewhocares.org/hosts/zero/hosts), [l1k/osxparanoia/blob/master/hosts](https://github.com/l1k/osxparanoia/blob/master/hosts), [StevenBlack/hosts](https://github.com/StevenBlack/hosts) and [gorhill/uMatrix/hosts-files.json](https://github.com/gorhill/uMatrix/blob/master/assets/umatrix/hosts-files.json).\r\n\r\n#### dnsmasq\r\n\r\nInstall and use [dnsmasq](http://www.thekelleys.org.uk/dnsmasq/doc.html) to cache replies, prevent upstreaming queries for unqualified names, and even block entire TLDs.\r\n\r\nUse it in combination with `dnscrypt` to also encrypt outgoing DNS traffic.\r\n\r\nIf you don't wish to use `dnscrypt`, you should at least use DNS [not provided](http://bcn.boulder.co.us/~neal/ietf/verisign-abuse.html) [by your ISP](http://hackercodex.com/guide/how-to-stop-isp-dns-server-hijacking/). Two popular alternatives are [Google DNS](https://developers.google.com/speed/public-dns/) and [OpenDNS](https://www.opendns.com/home-internet-security/).\r\n\r\n[DNSSEC](https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions) is a set of extensions to DNS which provide to DNS clients (resolvers) origin authentication of DNS data, authenticated denial of existence, and data integrity. All answers from DNSSEC protected zones are digitally signed. The signed records are authenticated via a chain of trust, starting with a set of verified public keys for the DNS root-zone. The current root-zone trust anchors may be downloaded [from IANA website](https://www.iana.org/dnssec/files). There are a number of resources on DNSSEC, but probably the best one is [dnssec.net website](http://www.dnssec.net).\r\n\r\nInstall `dnsmasq` and edit the configuration\r\n\r\n    brew install dnsmasq --with-dnssec\r\n\r\n    mkdir -p /usr/local/etc\r\n\r\n    cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf\r\n\r\n    vim /usr/local/etc/dnsmasq.conf\r\n    \r\n\r\nHave a look through the commented-out options. Here are a few recommended settings to enable,\r\n\r\n    # Forward queries to dnscrypt on localhost\r\n    server=127.0.0.1#5355\r\n\r\n    # Never forward plain names\r\n    domain-needed\r\n\r\n    # Blackhole Tor hidden services and local TLDs\r\n    address=/.onion/0.0.0.0\r\n    address=/.local/0.0.0.0\r\n    address=/.mycoolnetwork/0.0.0.0\r\n\r\n    # Never forward addresses in the non-routed address spaces\r\n    bogus-priv\r\n\r\n    # Reject private addresses from upstream nameservers\r\n    stop-dns-rebind\r\n    \r\n    # Query servers in order\r\n    strict-order\r\n\r\n    # Set the size of the cache\r\n    # The default is to keep 150 hostnames\r\n    cache-size=8192\r\n\r\n    # Optional logging directives\r\n    log-async\r\n    log-dhcp\r\n    log-queries\r\n    log-facility=/var/log/dnsmasq.log\r\n    \r\n    # DNSSEC options\r\n    dnssec\r\n    trust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5\r\n    dnssec-check-unsigned\r\n\r\nInstall and start the program\r\n\r\n    sudo cp -fv /usr/local/opt/dnsmasq/*.plist /Library/LaunchDaemons\r\n\r\n    sudo chown root /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist\r\n\r\n    sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist\r\n\r\nOpen **System Preferences** > **Network** and select your interface, then the **DNS** tab, select **+** and add `127.0.0.1` as a DNS server, or use the command,\r\n\r\n    sudo networksetup -setdnsservers \"Wi-Fi\" 127.0.0.1\r\n\r\nMake sure `dnsmasq` is running with `sudo lsof -ni UDP:53` and is correctly configured with `scutil` or `networksetup`:\r\n\r\n    $ scutil --dns\r\n    DNS configuration\r\n\r\n    resolver #1\r\n      search domain[0] : mycoolnetwork\r\n      nameserver[0] : 127.0.0.1\r\n      flags    : Request A records, Request AAAA records\r\n      reach    : Reachable,Local Address\r\n\r\n    $ networksetup -getdnsservers \"Wi-Fi\"\r\n    127.0.0.1\r\n\r\n**Note** Some VPN software overrides DNS settings on connect. See [issue #24](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/24) for more information.\r\n\r\n##### Test DNSSEC validation\r\nTest DNSSEC validation succeeds for signed zones:\r\n\r\n    $ dig +dnssec icann.org\r\n\r\nReply should have `NOERROR` status and contain `ad` flag. For instance,\r\n\r\n    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 47039\r\n    ;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\nTest DNSSEC validation fails for zones that are signed improperly:\r\n\r\n    $ dig www.dnssec-failed.org\r\n\r\nReply should have `SERVFAIL` status. For instance,\r\n\r\n    ;; ->>HEADER<<- opcode: QUERY, status: SERVFAIL, id: 15190\r\n    ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\n#### dnscrypt\r\n\r\nUse [dnscrypt](https://dnscrypt.org/) to encrypt DNS traffic to the provider of choice.\r\n\r\nIf you prefer a GUI application, see [alterstep/dnscrypt-osxclient](https://github.com/alterstep/dnscrypt-osxclient).\r\n\r\nInstall the program\r\n\r\n    brew install dnscrypt-proxy\r\n\r\n    sudo cp -fv /usr/local/opt/dnscrypt-proxy/*.plist /Library/LaunchDaemons\r\n\r\n    sudo chown root /Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist\r\n\r\nIf using in combination with `dnsmasq`, edit `/Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist` to have this line\r\n\r\n    <string>--local-address=127.0.0.1:5355</string>\r\n\r\nBelow the line\r\n\r\n    <string>/usr/local/opt/dnscrypt-proxy/sbin/dnscrypt-proxy</string>\r\n\r\n<img width=\"916\" alt=\"dnscrypt\" src=\"https://cloud.githubusercontent.com/assets/12475110/10596750/94644540-76b5-11e5-8ddb-15c0130f7827.png\">\r\n\r\n*Append a local-address line to use dnscrypt on a port other than 53, like 5355.*\r\n\r\nBy default, the `resolvers-list` will point to the dnscrypt version specific resolvers file. When dnscrypt is updated, this version may no longer exist, and if it does, may point to an outdated file. This can be fixed by changing the resolvers file in `/Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist` to the symlinked version in `/usr/local/share`:\r\n\r\n    <string>--resolvers-list=/usr/local/share/dnscrypt-proxy/dnscrypt-resolvers.csv</string>\r\n\r\nFinally, start the program\r\n\r\n    sudo launchctl load /Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist\r\n\r\nMake sure `dnscrypt` is running with `sudo lsof -ni UDP:5355` or `ps -ef | grep '[d]nscrypt'`\r\n\r\n> By default, dnscrypt-proxy runs on localhost (127.0.0.1), port 53,\r\nand under the \"nobody\" user using the dnscrypt.eu-dk DNSCrypt-enabled\r\nresolver. If you would like to change these settings, you will have to edit\r\nthe plist file (e.g., --resolver-address, --provider-name, --provider-key, etc.)\r\n\r\nThis can be accomplished by editing `/Library/LaunchDaemons/homebrew.mxcl.dnscrypt-proxy.plist`.\r\n\r\nYou can run your own [dnscrypt server](https://github.com/Cofyc/dnscrypt-wrapper) from a trusted location or use one of many [public servers](https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv) instead.\r\n\r\nMake sure it's working with `tcpdump` or Wireshark\r\n\r\n    $ sudo tcpdump -qtni en0\r\n    IP 10.8.8.8.59636 > 77.66.84.233.443: UDP, length 512\r\n    IP 77.66.84.233.443 > 10.8.8.8.59636: UDP, length 368\r\n\r\n    $ dig +short -x 77.66.84.233\r\n    resolver2.dnscrypt.eu\r\n\r\nSee also [What is a DNS leak and why should I care?](https://dnsleaktest.com/what-is-a-dns-leak.html) and the [mDNSResponder manual page](https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man8/mDNSResponder.8.html).\r\n\r\n## Captive portal\r\n\r\nWhen OS X connects to new networks, it **probes** the network and launches a Captive Portal assistant utility if connectivity can't be determined.\r\n\r\nAn attacker could trigger the utility and direct a Mac to a site with malware without user interaction, so it's best to disable this feature and log in to captive portals using your regular Web browser.\r\n\r\n    sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.captive.control Active -bool false\r\n\r\nSee also [How to disable the captive portal window in Mac OS Lion](https://web.archive.org/web/20130407200745/http://www.divertednetworks.net/apple-captiveportal.html) and [An undocumented change to Captive Network Assistant settings in OS X 10.10 Yosemite](https://grpugh.wordpress.com/2014/10/29/an-undocumented-change-to-captive-network-assistant-settings-in-os-x-10-10-yosemite/).\r\n\r\n## Certificate authorities\r\nOS X El Capitan comes with [over 200 root certificate authorities](https://support.apple.com/en-us/HT205204) from for-profit corporations like Apple, Verisign, Thawte, Digicert and government agencies from China, Japan, Netherlands, U.S., and more! These CAs are capable of issuing SSL certificates for any domain or code signing certificates as well.\r\n\r\nFor more information, see [Certification Authority Trust Tracker](https://github.com/kirei/catt),\r\n\r\nand papers\r\n[Analysis of the HTTPS certificate ecosystem](http://conferences.sigcomm.org/imc/2013/papers/imc257-durumericAemb.pdf) [pdf]\r\n\r\nand [You Won’t Be Needing These Any More: On Removing Unused Certificates From Trust Stores](http://www.ifca.ai/fc14/papers/fc14_submission_100.pdf) [pdf]\r\n\r\nYou can inspect system root certificates in **Keychain Access**, under the **System Roots** tab or by using the `security` command line tool and `/System/Library/Keychains/SystemRootCertificates.keychain` file.\r\n\r\nYou can disable certificate authorities through Keychain Access by marking them as **Never Trust**.\r\n\r\nThe risk of a [man in the middle](https://en.wikipedia.org/wiki/Man-in-the-middle_attack) attack in which a coerced or compromised certificate authority trusted by your system issues a fake/rogue SSL certificate is quite low, but still [possible](https://en.wikipedia.org/wiki/DigiNotar#Issuance_of_fraudulent_certificates).\r\n\r\n## OpenSSL\r\n\r\nThe version of `openssl` in El Capitan is `0.9.8zg` which is [not current](https://apple.stackexchange.com/questions/200582/why-is-apple-using-an-older-version-of-openssl). It doesn't support TLS 1.1 or newer, elliptic curve ciphers, and [more](https://stackoverflow.com/questions/27502215/difference-between-openssl-09-8z-and-1-0-1).\r\n\r\nApple claims OpenSSL is **deprecated** in their [Cryptographic Services Guide\r\n](https://developer.apple.com/library/mac/documentation/Security/Conceptual/cryptoservices/GeneralPurposeCrypto/GeneralPurposeCrypto.html) document. Their version also has patches which may [surprise you](https://hynek.me/articles/apple-openssl-verification-surprises/).\r\n\r\nGrab a recent version of OpenSSL with `brew install openssl`. Note, linking brew to be used in favor of `/usr/bin/openssl` may interfere with building software. See [issue #39](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/39).\r\n\r\nFor example, compare the TLS protocol and cipher between the homebrew version and the system version of OpenSSL,\r\n\r\n    $ openssl version; echo | openssl s_client -connect github.com:443 2>&1 | grep -A2 SSL-Session\r\n    OpenSSL 1.0.2d 9 Jul 2015\r\n    SSL-Session:\r\n        Protocol  : TLSv1.2\r\n        Cipher    : ECDHE-RSA-AES128-GCM-SHA256\r\n\r\n    $ ^openssl^/usr/bin/openssl\r\n    OpenSSL 0.9.8zg 14 July 2015\r\n    SSL-Session:\r\n        Protocol  : TLSv1\r\n        Cipher    : AES128-SHA\r\n\r\nAlso see [Comparison of TLS implementations\r\n](https://en.wikipedia.org/wiki/Comparison_of_TLS_implementations), [How's My SSL](https://www.howsmyssl.com/), as well as [Qualys SSL Labs Tools](https://www.ssllabs.com/projects/).\r\n\r\n## Curl\r\n\r\nThe version of `curl` which comes with OS X uses [Secure Transport](https://developer.apple.com/library/mac/documentation/Security/Reference/secureTransportRef/) for SSL/TLS validation.\r\n\r\nIf you prefer to use OpenSSL, install with `brew install curl --with-openssl` and ensure it's the default with `brew link --force curl`\r\n\r\nHere are several recommended, self-explanatory [options](http://curl.haxx.se/docs/manpage.html) to add to `~/.curlrc`\r\n\r\n    user-agent = \"Mozilla/5.0 (Windows NT 6.1; rv:31.0) Gecko/20100101 Firefox/31.0\"\r\n    referer = \";auto\"\r\n    connect-timeout = 10\r\n    progress-bar\r\n    max-time = 90\r\n    verbose\r\n    show-error\r\n    remote-time\r\n    ipv4\r\n\r\n## HTTP\r\nConsider using [privoxy](http://www.privoxy.org/) as a local proxy to sanitize and customize web browsing traffic.\r\n\r\nA signed installation package for privoxy can be downloaded from [Sourceforge](http://sourceforge.net/projects/ijbswa/files/Macintosh%20%28OS%20X%29/) or [silvester.org.uk](http://silvester.org.uk/privoxy/OSX/). The signed package is [more secure](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/65) than the Homebrew version, and attracts full support from the Privoxy project.\r\n\r\nAlternatively, install and start privoxy using Homebrew:\r\n\r\n    brew install privoxy\r\n\r\n    ln -sfv /usr/local/opt/privoxy/*.plist ~/Library/LaunchAgents\r\n\r\n    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.privoxy.plist\r\n\r\nBy default, privoxy listens on local TCP port 8118.\r\n\r\nSet the system **http** proxy for your active network interface `127.0.0.1` and `8118`. This can be done through **System Preferences > Network > Advanced > Proxies**, or\r\n\r\n    sudo networksetup -setwebproxy \"Wi-Fi\" 127.0.0.1 8118\r\n\r\nOptionally, you can set the system **https** proxy, which allows for domain name filtering, with\r\n\r\n    sudo networksetup -setsecurewebproxy \"Wi-Fi\" 127.0.0.1 8118\r\n\r\nConfirm the proxy is set with the command `scutil --proxy`. You can also visit <http://p.p/> in a web browser, or use\r\n\r\n    ALL_PROXY=127.0.0.1:8118 curl -I http://p.p/\r\n\r\nPrivoxy already comes with many good rules, however you can also write your own.\r\n\r\nEdit `/usr/local/etc/privoxy/user.action` to filter elements by domain or with regular expressions, e.g.:\r\n\r\n    { +block{unwanted stuff} }\r\n    www.facebook.com/(extern|plugins)/(login_status|like(box)?|activity|fan)\\.php\r\n    .foxnews.com\r\n    /cleardot.gif\r\n    /.*linkedin.*\r\n\r\n    { +block{ad images} +handle-as-image }\r\n    /.*1x1.gif\r\n    /.*fb-icon.*\r\n    /assets/social-.*\r\n    /img/social.*\r\n\r\nWrite simple or complex rules for redirection, such as upgrading connections to HTTPS, e.g.:\r\n\r\n    { +redirect{s@http://@https://@} }\r\n    code.jquery.com\r\n    imgur.com\r\n    .wikipedia.org\r\n\r\nYou can even replace all ad images with pictures of kittens by running a local web server.\r\n\r\nConsider logging and monitoring privoxy requests so you can be inspired to write custom rules.\r\n\r\n## Web browsing\r\nThe web browser poses the largest security and privacy risk, as its fundamental job is to download and execute untrusted code from the Internet.\r\n\r\nUse [Google Chrome](https://www.google.com/chrome/browser/desktop/) for most of your browsing. It offers [separate profiles](https://www.chromium.org/user-experience/multi-profiles), [good sandboxing](https://www.chromium.org/developers/design-documents/sandbox) and [frequent updates](http://googlechromereleases.blogspot.com/) (including Flash, although you should disable it - see below).\r\n\r\nChrome also comes with a great [PDF viewer](http://0xdabbad00.com/2013/01/13/most-secure-pdf-viewer-chrome-pdf-viewer/).\r\n\r\nIf you don't want to use Chrome, [Firefox](https://www.mozilla.org/en-US/firefox/new/) is an excellent browser as well. Or simply use both. See discussion in [issue #2](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/2).\r\n\r\nIf using Firefox, see [TheCreeper/PrivacyFox](https://github.com/TheCreeper/PrivacyFox) for recomended privacy preferences.\r\n\r\nCreate at least three profiles, one for browsing **trusted** web sites (email, banking), another for **untrusted** (link aggregators, news sites), and a third for a completely **cookie-less** and **script-less** experience.\r\n\r\n* One profile **without cookies or Javascript** enabled (e.g., turned off in `chrome://settings/content`) which should be the **preferred** profile to visiting untrusted web sites. However, many pages will not load at all without Javascript enabled.\r\n\r\n* One profile with [uMatrix](https://github.com/gorhill/uMatrix) (or [uBlock](https://github.com/chrisaljoudi/uBlock), a simpler version). Use this profile for visiting **mostly trusted** web sites. Take time to learn how these **firewall** extensions work. Other frequently recommended extensions are [Privacy Badger](https://www.eff.org/privacybadger),  [HTTPSEverywhere](https://www.eff.org/https-everywhere) and [CertPatrol](http://patrol.psyced.org/) (Firefox only).\r\n\r\n* One (or more) profile for your \"real name\", signed-in browsing needs such as banking and email (however, don't open email links from this profile).\r\n\r\nThe idea is to separate and compartmentalize your data, so that an exploit or privacy violation in one session does not necessarily affect data in another.\r\n\r\nIn each profile, visit `chrome://plugins/` and **disable Adobe Flash** plugin. If you **must** use Flash, create a separate profile, make sure to only use **HTTPS**, and also visit `chrome://settings/contents` to select **Let me choose when to run plugin content**, under the Plugins section (also known as *click-to-play*).\r\n\r\nTake some time to read through [Chromium Security](https://www.chromium.org/Home/chromium-security) and [Chromium Privacy](https://www.chromium.org/Home/chromium-privacy).\r\n\r\nFor example you may wish to disable [DNS prefetching](https://www.chromium.org/developers/design-documents/dns-prefetching) (see also [DNS Prefetching and Its Privacy Implications](https://www.usenix.org/legacy/event/leet10/tech/full_papers/Krishnan.pdf) [pdf]).\r\n\r\nDo **not** use other Chromium-derived browsers. They are usually [closed source](http://yro.slashdot.org/comments.pl?sid=4176879&cid=44774943), [poorly maintained](https://plus.google.com/+JustinSchuh/posts/69qw9wZVH8z), or make dubious claims to protect privacy. See [The Private Life of Chromium Browsers](http://thesimplecomputer.info/the-private-life-of-chromium-browsers).\r\n\r\nDo **not** use Safari. The code is a mess and [security](https://nakedsecurity.sophos.com/2014/02/24/anatomy-of-a-goto-fail-apples-ssl-bug-explained-plus-an-unofficial-patch/) [vulnerabilities](https://vimeo.com/144872861) are frequent, and slower to patch (see also [discussion on Hacker News](https://news.ycombinator.com/item?id=10150038)). If you do use Safari, at least [disable](https://thoughtsviewsopinions.wordpress.com/2013/04/26/how-to-stop-downloaded-files-opening-automatically/) the *Open \"safe\" files after downloading* option in Preferences.\r\n\r\nFor more information about security conscious browsing, see [HowTo: Privacy & Security Conscious Browsing](https://gist.github.com/atcuno/3425484ac5cce5298932), [browserleaks.com](https://www.browserleaks.com/) and [EFF Panopticlick](https://panopticlick.eff.org/).\r\n\r\n## Plugins\r\n**Adobe Flash**, **Oracle Java**, **Adobe Reader**, **Microsoft Silverlight** (Netflix now works with [HTML5](https://help.netflix.com/en/node/23742)) and other plugins are [security risks](https://news.ycombinator.com/item?id=9901480) and should not be installed. \r\n\r\nIf they are necessary, only use them in a disposable virtual machine and subscribe to security announcements to make sure you're always patched.\r\n\r\nSee [Hacking Team Flash Zero-Day](http://blog.trendmicro.com/trendlabs-security-intelligence/hacking-team-flash-zero-day-integrated-into-exploit-kits/), [Java Trojan BackDoor.Flashback](https://en.wikipedia.org/wiki/Trojan_BackDoor.Flashback), [Acrobat Reader: Security Vulnerabilities](http://www.cvedetails.com/vulnerability-list/vendor_id-53/product_id-497/Adobe-Acrobat-Reader.html), and [Angling for Silverlight Exploits](https://blogs.cisco.com/security/angling-for-silverlight-exploits), for example.\r\n\r\n## PGP/GPG\r\nPGP is a standard for encrypting email end to end. That means only the chosen recipients can decrypt a message, unlike regular email which is read and forever archived by providers.\r\n\r\n**GPG**, or **GNU Privacy Guard**, is a GPL licensed program compliant with the standard.\r\n\r\n**GPG** is used to verify signatures of software you download and install, as well as [symmetrically](https://en.wikipedia.org/wiki/Symmetric-key_algorithm) or [asymmetrically](https://en.wikipedia.org/wiki/Public-key_cryptography) encrypt files and text.\r\n\r\nInstall with `brew install gnupg`, or if you prefer to install a newer, more feature-rich [stable version](https://www.gnupg.org/), use `brew install homebrew/versions/gnupg21`\r\n\r\nIf you prefer a GUI, check out [GPG Suite](https://gpgtools.org/)\r\n\r\nHere are several recommended options to add to `~/.gnupg/gpg.conf`\r\n\r\n    auto-key-locate keyserver\r\n    keyserver hkps://hkps.pool.sks-keyservers.net\r\n    keyserver-options no-honor-keyserver-url\r\n    keyserver-options ca-cert-file=/etc/sks-keyservers.netCA.pem\r\n    keyserver-options no-honor-keyserver-url\r\n    keyserver-options debug\r\n    keyserver-options verbose\r\n    personal-cipher-preferences AES256 AES192 AES CAST5\r\n    personal-digest-preferences SHA512 SHA384 SHA256 SHA224\r\n    default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed\r\n    cert-digest-algo SHA512\r\n    s2k-digest-algo SHA512\r\n    charset utf-8\r\n    fixed-list-mode\r\n    no-comments\r\n    no-emit-version\r\n    keyid-format 0xlong\r\n    list-options show-uid-validity\r\n    verify-options show-uid-validity\r\n    with-fingerprint\r\n\r\nInstall the keyservers CA certificate\r\n\r\n    curl -O https://sks-keyservers.net/sks-keyservers.netCA.pem\r\n\r\n    sudo mv sks-keyservers.netCA.pem /etc\r\n\r\nThese settings will configure GnuPG to use SSL when fetching new keys and prefer strong cryptographic primitives.\r\n\r\nSee also [ioerror/duraconf/configs/gnupg/gpg.conf](https://github.com/ioerror/duraconf/blob/master/configs/gnupg/gpg.conf). You should also take some time to read [OpenPGP Best Practices](https://help.riseup.net/en/security/message-security/openpgp/best-practices).\r\n\r\nIf you don't already have a keypair, create one using `gpg --gen-key`\r\n\r\nRead [online](https://alexcabal.com/creating-the-perfect-gpg-keypair/) [guides](https://security.stackexchange.com/questions/31594/what-is-a-good-general-purpose-gnupg-key-setup) and practice encrypting and decrypting email to yourself and your friends. Get them interested in this stuff!\r\n\r\n## OTR\r\nOTR stands for **Off-the-Record** and is a cryptographic protocol for encrypting and authenticating conversations over instant messaging.\r\n\r\nYou can use OTR on top of any existing **XMPP** chat service, even Google Hangouts (which only encrypts conversations between users and the server).\r\n\r\nThe first time you start a conversation with someone new, you'll be asked to verify their public key fingerprint. Make sure to do this in person or by some other secure means (e.g. GPG encrypted mail).\r\n\r\nA popular OS X GUI client for XMPP and other chat protocols is [Adium](https://adium.im/)\r\n\r\nConsider downloading the [beta version](https://beta.adium.im/) which uses OAuth2, making logging in to Google Talk/Hangouts [more secure](https://trac.adium.im/ticket/16161).\r\n\r\n    Adium_1.5.11b2.dmg\r\n\r\n    SHA-256: e7690718f14defa3bc08cd3949a4eab52e942abd47f7ac2ce7157ed7295658c6\r\n    SHA-1:   7f0271d4fe9835b4554225510e758a3c46c10b6a\r\n\r\nRemember to [disable logging](https://trac.adium.im/ticket/15722) for OTR chats with Adium.\r\n\r\nA good console-based XMPP client is [profanity](http://www.profanity.im/)  which can be installed with `brew install profanity`\r\n\r\nAlso, check out [Tor Messenger](https://blog.torproject.org/blog/tor-messenger-beta-chat-over-tor-easily), although it is still in beta.\r\n\r\nIf you want to know how OTR works, read the paper [Off-the-Record Communication, or, Why Not To Use PGP](https://otr.cypherpunks.ca/otr-wpes.pdf) [pdf].\r\n\r\n## Tor\r\nTor is an anonymizing proxy which can be used for browsing the web.\r\n\r\nDownload Tor Browser from <https://www.torproject.org/projects/torbrowser.html>.\r\n\r\nDo **not** attempt to configure other browsers to use Tor as you are likely make a mistake which will compromise your anonymity.\r\n\r\nAfter downloading the `dmg` and `asc` files, verify the disk image has been signed by Tor developers with `gpg TorBrowser*asc`\r\n\r\nYou may see a warning - the public key was not found. Fetch it from the keyserver with `gpg --recv-keys 0x2E1AC68ED40814E0` and verify again.\r\n\r\nMake sure `Good signature from \"Tor Browser Developers (signing key) <torbrowser@torproject.org>\"` appears in the output. You may see a benign warning if the key has not been manually assigned trust.\r\n\r\n<img width=\"872\" alt=\"Example of valid signature output\" src=\"https://cloud.githubusercontent.com/assets/12475110/10712417/e7485bb4-7a68-11e5-9bdb-e27bdd3742fd.png\">\r\n\r\n*Example of valid signature output*\r\n\r\nSee [How to verify signatures for packages](https://www.torproject.org/docs/verifying-signatures.html) for more information.\r\n\r\nTor traffic is **encrypted** to the [exit node](https://en.wikipedia.org/wiki/Tor_(anonymity_network)#Exit_node_eavesdropping) (i.e., cannot be read by a passive network eavesdropper), but **can** be identified.\r\n\r\nJust one example way is by monitoring TLS handshakes:\r\n\r\n    $ sudo tcpdump -Ani en0 \"tcp\" | grep \"www\"\r\n    .............&.$..!www.ht50d2u6ky6y7kbcxhe5mjfdi.com.........\r\n    .~7...~.|.Lp*e.....L._..........ug.......[.net0.brU.....fP...a&..'.]...r.....E*F....{...qjJ}....).$8....\t....V.E..0\r\n    ...................www.s4ku5skci.net.........\r\n    l..5...R[i.0...A.$...l..Ly.....}..ZY..../.........LH.0..\\...3.?.........*.N... ..._/G\\...0*..?...`d.........0\t...X..&.N0\r\n    ^C\r\n\r\nSee [Tor Protocol Specification](https://gitweb.torproject.org/torspec.git/tree/tor-spec.txt) and [Tor/TLSHistory](https://trac.torproject.org/projects/tor/wiki/org/projects/Tor/TLSHistory) for more information.\r\n\r\nYou may wish to additionally obfuscate Tor traffic using a [pluggable transport](https://www.torproject.org/docs/pluggable-transports.html), such as [Yawning/obfs4proxy](https://github.com/Yawning/obfs4) or [SRI-CSL/stegotorus](https://github.com/SRI-CSL/stegotorus).\r\n\r\nThis can be done by setting up your own [Tor relay](https://www.torproject.org/docs/tor-relay-debian.html) or finding an existing private or public [bridge](https://www.torproject.org/docs/bridges.html.en#RunningABridge) to serve as an obfuscating entry node.\r\n\r\nFor extra security, use Tor inside a [VirtualBox](https://www.virtualbox.org/wiki/Downloads) or [VMware](https://www.vmware.com/products/fusion) virtualized [GNU/Linux](http://www.brianlinkletter.com/installing-debian-linux-in-a-virtualbox-virtual-machine/) or [BSD](http://www.openbsd.org/faq/faq4.html) machine.\r\n\r\nFinally, remember the Tor network provides [anonymity](https://www.privateinternetaccess.com/blog/2013/10/how-does-privacy-differ-from-anonymity-and-why-are-both-important/), which is not necessarily synonymous with privacy. The Tor network does not guarantee protection against a global observer capable of traffic analysis and [correlation](https://blog.torproject.org/category/tags/traffic-correlation). See also [Seeking Anonymity in an Internet Panopticon](http://bford.info/pub/net/panopticon-cacm.pdf) [pdf] and [Traffic Correlation on Tor by Realistic Adversaries](http://www.ohmygodel.com/publications/usersrouted-ccs13.pdf) [pdf].\r\n\r\n## VPN\r\nIf you use your Mac on untrusted networks - airports, cafes, etc. - your network traffic is being monitored and possibly tampered with.\r\n\r\nIt is a good idea to use a VPN which encrypts **all** outgoing network traffic (i.e., not **split tunnel**) with a provider you trust. Ideally, that provider is a server in your house or a trustworthy \"cloud\".\r\n\r\nDon't just blindly sign up for a VPN service without understanding the full implications and how your traffic will be routed. If you don't understand how the VPN works or are not familiar with the software used, you are probably better off without it.\r\n\r\nWhen choosing a VPN service or setting up your own, be sure to research the protocols, key exchange algorithms, authentication mechanisms, and type of encryption being used. Some protocols, such as [PPTP](https://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol#Security), should be avoided in favor of [OpenVPN](https://en.wikipedia.org/wiki/OpenVPN), for example.\r\n\r\nSome clients may send traffic traffic over the next available interface when VPN is interrupted or disconnected. See [scy/8122924](https://gist.github.com/scy/8122924) for an example on how to allow traffic only over VPN.\r\n\r\n## Viruses and malware\r\nThere is an ever-increasing amount of Mac malware in the wild. Macs aren't immune from viruses and malicious software!\r\n\r\nSome malware comes bundled with both legitimate software, such as the [Java bundling Ask Toolbar](http://www.zdnet.com/article/oracle-extends-its-adware-bundling-to-include-java-for-macs/), and some with illegitimate software, such as [Mac.BackDoor.iWorm](https://docs.google.com/document/d/1YOfXRUQJgMjJSLBSoLiUaSZfiaS_vU3aG4Bvjmz6Dxs/edit?pli=1) bundled with pirated programs.\r\n\r\nSee [Methods of malware persistence on Mac OS X](https://www.virusbtn.com/pdf/conference/vb2014/VB2014-Wardle.pdf) [pdf] and [Malware Persistence on OS X Yosemite](https://www.rsaconference.com/events/us15/agenda/sessions/1591/malware-persistence-on-os-x-yosemite) to learn about how garden-variety malware functions.\r\n\r\nYou can periodically run a tool like [Knock Knock](https://github.com/synack/knockknock) to examine persistent binaries (e.g. scripts, binaries). But by then, it is probably too late. Maybe [Block Block](https://objective-see.com/products/blockblock.html) will help.\r\n\r\n**Anti-virus** programs are a double-edged sword -- not useful for **advanced** users and will likely increase attack surface against sophisticated threats, however possibly useful for catching \"garden variety\" malware on **novice** users' Macs. There is also the additional processing overhead to consider.\r\n\r\nSee [Sophail: Applied attacks against  Antivirus](https://lock.cmpxchg8b.com/sophailv2.pdf) [pdf], [Analysis and Exploitation of an ESET Vulnerability](http://googleprojectzero.blogspot.ro/2015/06/analysis-and-exploitation-of-eset.html), [a trivial Avast RCE](https://code.google.com/p/google-security-research/issues/detail?id=546), [Popular Security Software Came Under Relentless NSA and GCHQ Attacks](https://theintercept.com/2015/06/22/nsa-gchq-targeted-kaspersky/), and [AVG: \"Web TuneUP\" extension multiple critical vulnerabilitie](https://code.google.com/p/google-security-research/issues/detail?id=675).\r\n\r\nTherefore, the best anti-virus is **Common Sense 2016**. See more discussion in [issue #44](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/44).\r\n\r\nLocal privilege escalation bugs are plenty on OS X, so always be careful when downloading and running untrusted programs or trusted programs from third party websites or downloaded over HTTP ([example](http://arstechnica.com/security/2015/08/0-day-bug-in-fully-patched-os-x-comes-under-active-exploit-to-hijack-macs/)).\r\n\r\nHave a look at [The Safe Mac](http://www.thesafemac.com/) for past and current Mac security news.\r\n\r\nAlso check out [Hacking Team](https://www.schneier.com/blog/archives/2015/07/hacking_team_is.html) malware for Mac OS: [root installation for MacOS](https://github.com/hackedteam/vector-macos-root), [Support driver for Mac Agent](https://github.com/hackedteam/driver-macos) and [RCS Agent for Mac](https://github.com/hackedteam/core-macos), which is a good example of advanced malware with capabilities to hide from **userland** (e.g., `ps`, `ls`), for example.\r\n\r\n## System Integrity Protection\r\n\r\n[System Integrity Protection](https://support.apple.com/en-us/HT204899) (SIP) is a new security feature of OS X 10.11. It is enabled by default, but [can be disabled](https://derflounder.wordpress.com/2015/10/01/system-integrity-protection-adding-another-layer-to-apples-security-model/), which may be necessary to change some system settings, such as deleting root certificate authorities or unloading certain launch daemons.\r\n\r\nFrom [What's New in OS X 10.11](https://developer.apple.com/library/prerelease/mac/releasenotes/MacOSX/WhatsNewInOSX/Articles/MacOSX10_11.html):\r\n\r\n> A new security policy that applies to every running process, including privileged code and code that runs out of the sandbox. The policy extends additional protections to components on disk and at run-time, only allowing system binaries to be modified by the system installer and software updates. Code injection and runtime attachments to system binaries are no longer permitted.\r\n\r\n## Gatekeeper and Xprotect\r\n\r\n**Gatekeeper** and the **quarantine** system try to prevent unsigned or \"bad\" programs and files from running and opening.\r\n\r\n**Xprotect** prevents the execution of known bad files and outdated plugin versions, but does nothing to cleanup or stop existing malware.\r\n\r\nBoth offer trivial protection against common risks and are fine at default settings.\r\n\r\nSee also [Mac Malware Guide : How does Mac OS X protect me?](http://www.thesafemac.com/mmg-builtin/) and [Gatekeeper, XProtect and the Quarantine attribute](http://ilostmynotes.blogspot.com/2012/06/gatekeeper-xprotect-and-quarantine.html).\r\n\r\n**Note** Quarantine stores information about downloaded files in `~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2`, which may pose a privacy risk. To examine the file, use `strings` or,\r\n\r\n    echo 'SELECT datetime(LSQuarantineTimeStamp + 978307200, \"unixepoch\") as LSQuarantineTimeStamp, LSQuarantineAgentName, LSQuarantineOriginURLString, LSQuarantineDataURLString from LSQuarantineEvent;' | sqlite3 /Users/$USER/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2\r\n\r\n\r\nSee [here](http://www.zoharbabin.com/hey-mac-i-dont-appreciate-you-spying-on-me-hidden-downloads-log-in-os-x/) for more information.\r\n\r\nFurthermore, OS X attaches metadata ([HFS+ extended attributes](https://en.wikipedia.org/wiki/Extended_file_attributes#OS_X)) to downloaded files, e.g.\r\n\r\n    $ ls -l@ adobe_flashplayer_setup.dmg\r\n    -rw-r-----@ 1 drduh  staff  1000000 Sep  1 12:00 adobe_flashplayer_setup.dmg\r\n\tcom.apple.diskimages.fsck\t     20\r\n\tcom.apple.diskimages.recentcksum\t     79\r\n\tcom.apple.metadata:kMDItemWhereFroms\t   2737\r\n\tcom.apple.quarantine\t     68\r\n\r\n\t$ xattr -l com.apple.metadata:kMDItemWhereFroms adobe_flashplayer_setup.dmg\r\n\t[output omitted]\r\n\r\n## Passwords\r\nYou can generate strong passwords with `gpg`, `openssl` or just get creative with `/dev/urandom` output.\r\n\r\n    $ openssl rand -base64 30\r\n    LK9xkjUEAemc1gV2Ux5xqku+PDmMmCbSTmwfiMRI\r\n\r\n    $ gpg --gen-random -a 0 30\r\n    4/bGZL+yUEe8fOqQhF5V01HpGwFSpUPwFcU3aOWQ\r\n\r\n    $ dd if=/dev/urandom bs=1 count=30 2>/dev/null | base64\r\n    CbRGKASFI4eTa96NMrgyamj8dLZdFYBaqtWUSxKe\r\n\r\nYou can also generate passwords, even memorable ones, using **Keychain Access** password assistant, or a command line equivalent like [anders/pwgen](https://github.com/anders/pwgen).\r\n\r\n**Keychains** are encrypted with a [PBKDF2 derived key](https://en.wikipedia.org/wiki/PBKDF2) and are a _pretty safe_ place to store credentials. See also [Breaking into the OS X keychain](http://juusosalonen.com/post/30923743427/breaking-into-the-os-x-keychain).\r\n\r\nAlternatively, you can manage an encrypted passwords file yourself with `gpg` (shameless plug for my [pwd.sh](https://github.com/drduh/pwd.sh) script).\r\n\r\nIn addition to passwords, ensure eligible online accounts, such as Github, Google accounts, banking, have [two factor authentication](https://en.wikipedia.org/wiki/Two-factor_authentication) enabled.\r\n\r\nLook to [Yubikey](https://www.yubico.com/products/yubikey-hardware/yubikey-neo/) for a two factor and private key (e.g., ssh, gpg) hardware token. One of two Yubikey's slots can also be programmed to emit a long, static password (which can be used in combination with a short, memorized password, for example).\r\n\r\n## Backup\r\nAlways encrypt files locally before backing them up to external media or online services. One way is to use a symmetric cipher with **gpg** and a password of your choosing.\r\n\r\nTo encrypt, use\r\n\r\n    tar zcvf - ~/Downloads | gpg -c > ~/Desktop/backup-$(date +%F-%H%M).tar.gz.gpg\r\n\r\nTo decrypt, use\r\n\r\n    gpg -o ~/Desktop/decrypted-backup.tar.gz \\\r\n      -d ~/Desktop/backup-2015-01-01-0000.tar.gz.gpg && \\\r\n      tar zxvf ~/Desktop/decrypted-backup.tar.gz\r\n\r\nYou may also create encrypted volumes using **Disk Utility**, or `hdiutil`, e.g.:\r\n\r\n    hdiutil create ~/Desktop/encrypted.dmg -encryption -size 1g -volname \"Name\" -fs JHFS+\r\n\r\nAlso see the following applications and services: [SpiderOak](https://spideroak.com/), [Arq](https://www.arqbackup.com/), [Espionage](https://www.espionageapp.com/), and [restic](https://restic.github.io/).\r\n\r\n## Wi-Fi\r\nOS X remembers access points it has connected to. Like all wireless devices, the Mac will broadcast all access point names it remembers (e.g., *MyHomeNetwork*) each time it looks for a network, such as when waking from sleep.\r\n\r\nThis is a privacy risk, so remove networks from the list in **System Preferences** > **Network** > **Advanced** when they're no longer needed.\r\n\r\nAlso see [Signals from the Crowd: Uncovering Social Relationships through Smartphone Probes](http://conferences.sigcomm.org/imc/2013/papers/imc148-barberaSP106.pdf) [pdf] and [Wi-Fi told me everything about you](http://confiance-numerique.clermont-universite.fr/Slides/M-Cunche-2014.pdf) [pdf].\r\n\r\nSaved Wi-Fi information (SSID, last connection, etc.) can be found in `/Library/Preferences/SystemConfiguration/com.apple.airport.preferences.plist`\r\n\r\nYou may wish to [spoof the MAC address](https://en.wikipedia.org/wiki/MAC_spoofing) of your network card before connecting to new and untrusted wireless networks to mitigate passive fingerprinting, e.g.:\r\n\r\n    sudo ifconfig en0 ether $(openssl rand -hex 6 | sed 's%\\(..\\)%\\1:%g; s%.$%%')\r\n\r\n**Note** MAC addresses will reset to their hardware defaults on each boot.\r\n\r\nAlso see [feross/SpoofMAC](https://github.com/feross/SpoofMAC).\r\n\r\nFinally, WEP protection on wireless networks is [not secure](http://www.howtogeek.com/167783/htg-explains-the-difference-between-wep-wpa-and-wpa2-wireless-encryption-and-why-it-matters/) and you should favor connecting to **WPA2** protected networks only to mitigate the risk of passive eavesdroppers.\r\n\r\n## SSH\r\nFor outgoing ssh connections, use hardware- or password-protected ssh keys, [set up](http://nerderati.com/2011/03/17/simplify-your-life-with-an-ssh-config-file/) remote hosts and consider [hashing](http://nms.csail.mit.edu/projects/ssh/) them.\r\n\r\nHere are several recommended [options](https://www.freebsd.org/cgi/man.cgi?query=ssh_config&sektion=5) to add to  `~/.ssh/ssh_config`\r\n\r\n    Host *\r\n      PasswordAuthentication no\r\n      ChallengeResponseAuthentication no\r\n      HashKnownHosts yes\r\n      UseRoaming no\r\n\r\nUseRoaming is an undocumented option in OpenSSH that is enabled by default and is vulnerable in OpenSSH versions 5.4 through 7.1. The vulnerabilities are detailed in [CVE-2016-0777 and CVE-2016-0778](http://undeadly.org/cgi?action=article&sid=20160114142733).\r\n\r\nYou can also use ssh to create an [encrypted tunnel](http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html) to send your traffic through, which is similar to a VPN.\r\n\r\nFor example, to use privoxy on a remote host:\r\n\r\n    ssh -C -L 5555:127.0.0.1:8118 you@remote-host.tld\r\n\r\n    sudo networksetup -setwebproxy \"Wi-Fi\" 127.0.0.1 5555\r\n\r\n    sudo networksetup -setsecurewebproxy \"Wi-Fi\" 127.0.0.1 5555\r\n\r\nBy default, OS X does **not** have sshd or *Remote Login* enabled.\r\n\r\nTo enable sshd and allow incoming ssh connections:\r\n\r\n    sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist\r\n\r\nOr use the **System Preferences** > **Sharing** menu.\r\n\r\nIf you are going to enable sshd, at least disable password authentication and consider further [hardening](https://stribika.github.io/2015/01/04/secure-secure-shell.html) your configuration.\r\n\r\nTo `/etc/sshd_config`, add\r\n\r\n    PasswordAuthentication no\r\n    ChallengeResponseAuthentication no\r\n    UsePAM no\r\n\r\n Confirm sshd is enabled or disabled with:\r\n\r\n    sudo lsof -ni TCP:22\r\n\r\n## Physical access\r\nKeep your Mac physically secure at all times. Don't leave it unattended in hotels and such.\r\n\r\nFor example, a skilled attacker with unsupervised physical access to your computer can infect the boot ROM to install a keylogger and steal your password - see [Thunderstrike](https://trmm.net/Thunderstrike), for example.\r\n\r\n## System monitoring\r\n\r\n#### Open source monitoring tools\r\n\r\n[facebook/osquery](https://github.com/facebook/osquery) can be used to retrieve low level system information.  Users can write SQL queries to retrieve system information.  More information can be found at <https://osquery.io/>.\r\n\r\n[google/grr](https://github.com/google/grr) is an incident response framework focused on remote live forensics.\r\n\r\n[jipegit/OSXAuditor](https://github.com/jipegit/OSXAuditor) analyzes artifacts on a running system, such as:\r\n\r\n - Quarantined files\r\n - Browser information\r\n \t- Safari history, downloads, topsites, LastSession, HTML5 databases and localstore\r\n \t- Firefox cookies, downloads, form history, permissions, places and signons\r\n \t- Chrome history and archives history, cookies, login data, top sites, web data, HTML5\r\n - User social media and email accounts\r\n - Wi-Fi access points\r\n\r\n#### OpenBSM audit\r\nOS X has a powerful OpenBSM auditing capability. You can use it to monitor process execution, network activity, and much more.\r\n\r\nUse `sudo praudit -l /dev/auditpipe` to tail audit logs, e.g.:\r\n\r\n    header,201,11,execve(2),0,Thu Sep  1 12:00:00 2015, + 195 msec,exec arg,/Applications/.evilapp/rootkit,path,/Applications/.evilapp/rootkit,path,/Applications/.evilapp/rootkit,attribute,100755,root,wheel,16777220,986535,0,subject,drduh,root,wheel,root,wheel,412,100005,50511731,0.0.0.0,return,success,0,trailer,201,\r\n\r\n\theader,88,11,connect(2),0,Thu Sep  1 12:00:00 2015, + 238 msec,argument,1,0x5,fd,socket-inet,2,443,173.194.74.104,subject,drduh,root,wheel,root,wheel,326,100005,50331650,0.0.0.0,return,failure : Operation now in progress,4354967105,trailer,88\r\n\r\n\theader,111,11,OpenSSH login,0,Thu Sep  1 12:00:00 2015, + 16 msec,subject_ex,drduh,drduh,staff,drduh,staff,404,404,49271,::1,text,successful login drduh,return,success,0,trailer,111,\r\n\r\nSee the manual pages for `audit`, `praudit`, `audit_control` and other files in `/etc/security`\r\n\r\n**Note** although `man audit` says the `-s` flag will synchronize the audit configuration, it appears necessary to reboot for changes to take effect.\r\n\r\nSee articles on [ilostmynotes.blogspot.com](http://ilostmynotes.blogspot.com/2013/10/openbsm-auditd-on-os-x-these-are-logs.html) and [derflounder.wordpress.com](https://derflounder.wordpress.com/2012/01/30/openbsm-auditing-on-mac-os-x/) for more information.\r\n\r\n#### DTrace\r\n\r\n`iosnoop` monitors disk I/O\r\n\r\n`opensnoop` monitors file opens\r\n\r\n`execsnoop` monitors execution of processes\r\n\r\n`errinfo` monitors failed system calls\r\n\r\n`dtruss` monitors all system calls\r\n\r\nSee `man -k dtrace` for more\r\n\r\n#### Execution\r\n\r\n`ps -ef` lists information about all running processes.\r\n\r\nYou can also view processes with **Activity Monitor**.\r\n\r\n`launchctl list` and `sudo launchctl list` lists loaded and running user and system launch daemons and agents.\r\n\r\n#### Network\r\n\r\n`sudo lsof -ni -P` lists all open Internet and network \"files\"\r\n\r\n`sudo netstat -atln` lists contents of various network-related data structures\r\n\r\nYou can also use [Wireshark](https://www.wireshark.org/) from the command line.\r\n\r\nMonitor DNS queries and replies\r\n\r\n    tshark -Y \"dns.flags.response == 1\" -Tfields \\\r\n      -e frame.time_delta \\\r\n      -e dns.qry.name \\\r\n      -e dns.a \\\r\n      -Eseparator=,\r\n\r\nMonitor HTTP requests and responses\r\n\r\n    tshark -Y \"http.request or http.response\" -Tfields \\\r\n      -e ip.dst \\\r\n      -e http.request.full_uri \\\r\n      -e http.request.method \\\r\n      -e http.response.code \\\r\n      -e http.response.phrase \\\r\n      -Eseparator=/s\r\n\r\nMonitor x509 certificates on the wire\r\n\r\n    tshark -Y \"ssl.handshake.certificate\" -Tfields \\\r\n      -e ip.src \\\r\n      -e x509sat.uTF8String \\\r\n      -e x509sat.printableString \\\r\n      -e x509sat.universalString \\\r\n      -e x509sat.IA5String \\\r\n      -e x509sat.teletexString \\\r\n      -Eseparator=/s -Equote=d\r\n\r\nAlso check out the GUI \"simple network activity monitor\" [BonzaiThePenguin/Loading](https://github.com/BonzaiThePenguin/Loading)\r\n\r\n## Miscellaneous\r\n\r\nIf you wish, disable [Diagnostics & Usage Data](https://github.com/fix-macosx/fix-macosx/wiki/Diagnostics-&-Usage-Data).\r\n\r\nConsider creating a second, non-administrator account for web browsing and general use which doesn't require elevated privileges. See [issue #9](https://github.com/drduh/OS-X-Security-and-Privacy-Guide/issues/9).\r\n\r\nIf you want to play **music** or watch **videos**, use [VLC media player](https://www.videolan.org/vlc/index.html) which is free and open source.\r\n\r\nIf you want to **torrent**, use [Transmission](http://www.transmissionbt.com/download/) which is free and open source.\r\n\r\nWatch the system log with **Console** or the `syslog -w` command.\r\n\r\nEnable [tty_tickets](http://blog.rongarret.info/2015/08/psa-beware-of-sudo-on-os-x.html) in the sudoers file.\r\n\r\nSet your screen to lock as soon as the screensaver starts\r\n\r\n    defaults write com.apple.screensaver askForPassword -int 1\r\n    defaults write com.apple.screensaver askForPasswordDelay -int 0\r\n\r\nExpose hidden files and Library folder in Finder\r\n\r\n    defaults write com.apple.finder AppleShowAllFiles -bool true\r\n    chflags nohidden ~/Library\r\n\r\nDon't default to saving documents to iCloud\r\n\r\n    defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false\r\n\r\n[Disable Handoff](https://apple.stackexchange.com/questions/151481/why-is-my-macbook-visibile-on-bluetooth-after-yosemite-install) and Bluetooth features, if they aren't necessary.\r\n\r\nConsider [sandboxing](https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/sandbox-exec.1.html) your applications. See [fG! Sandbox Guide](https://reverse.put.as/wp-content/uploads/2011/09/Apple-Sandbox-Guide-v0.1.pdf) [pdf] and [s7ephen/OSX-Sandbox--Seatbelt--Profiles](https://github.com/s7ephen/OSX-Sandbox--Seatbelt--Profiles).\r\n\r\nDid you know Apple has not shipped a computer with TPM since [2006](http://osxbook.com/book/bonus/chapter10/tpm/)?\r\n\r\n## Additional resources\r\n\r\n*In no particular order*\r\n\r\n[OS X Yosemite Core Technologies Overview White Paper](https://www.apple.com/osx/pdf/OSXYosemite_TO_FF1.pdf)\r\n\r\n[Reversing Engineering Mac OS X blog](https://reverse.put.as/)\r\n\r\n[Reverse Engineering Resources](http://samdmarshall.com/re.html)\r\n\r\n[Patrick Wardle's Objective-See blog](https://objective-see.com/blog.html)\r\n\r\n[Dylib Hijack Scanner](https://objective-see.com/products/dhs.html)\r\n\r\n[Managing Macs at Google Scale (LISA '13)](https://www.usenix.org/conference/lisa13/managing-macs-google-scale)\r\n\r\n[OS X Hardening: Securing a Large Global Mac Fleet (LISA '13)](https://www.usenix.org/conference/lisa13/os-x-hardening-securing-large-global-mac-fleet)\r\n\r\n[Yelp's forensic evidence collection & analysis toolkit for OS X](https://github.com/yelp/osxcollector)\r\n\r\n[DoD Security Technical Implementation Guides for Mac OS](http://iase.disa.mil/stigs/os/mac/Pages/mac-os.aspx)\r\n\r\n[The EFI boot process](http://homepage.ntlworld.com/jonathan.deboynepollard/FGA/efi-boot-process.html)\r\n\r\n[The Intel Mac boot process](http://refit.sourceforge.net/info/boot_process.html)\r\n\r\n[Userland Persistence on Mac OS X](https://archive.org/details/joshpitts_shmoocon2015)\r\n\r\n[Developing Mac OSX kernel rootkits](http://phrack.org/issues/66/16.html#article)\r\n\r\n[IOKit kernel code execution exploit](https://code.google.com/p/google-security-research/issues/detail?id=135)\r\n\r\n[Hidden backdoor API to root privileges in Apple OS X](https://truesecdev.wordpress.com/2015/04/09/hidden-backdoor-api-to-root-privileges-in-apple-os-x/)\r\n\r\n[Santa: A binary whitelisting/blacklisting system for Mac OS X](https://github.com/google/santa/)\r\n\r\n[IPv6 Hardening Guide for OS X](http://www.insinuator.net/2015/02/ipv6-hardening-guide-for-os-x/)\r\n\r\n[Hacker News discussion](https://news.ycombinator.com/item?id=10148077)\r\n\r\n[Apple Open Source](https://opensource.apple.com/)\r\n\r\n[OS X 10.10 Yosemite: The Ars Technica Review](http://arstechnica.com/apple/2014/10/os-x-10-10/)\r\n\r\n[CIS Apple OSX 10.10 Benchmark](https://benchmarks.cisecurity.org/tools2/osx/CIS_Apple_OSX_10.10_Benchmark_v1.1.0.pdf) [pdf]\r\n\r\n[How to Switch to the Mac](https://taoofmac.com/space/HOWTO/Switch)\r\n\r\n[Security Configuration For Mac OS X Version 10.6 Snow Leopard](http://www.apple.com/support/security/guides/docs/SnowLeopard_Security_Config_v10.6.pdf) [pdf]\r\n\r\n[EFF Surveillance Self-Defense](https://ssd.eff.org/)\r\n\r\n[MacAdmins on Slack](https://macadmins.herokuapp.com/)\r\n\r\n[SummitRoute/osxlockdown](https://github.com/SummitRoute/osxlockdown)\r\n\r\n[iCloud security and privacy overview](http://support.apple.com/kb/HT4865)\r\n\r\n[Demystifying the DMG File Format](http://newosxbook.com/DMG.html)\r\n\r\n[libyal/libfvde](https://github.com/libyal/libfvde)\r\n\r\n[Mac OS X Forensics - Technical Report](https://www.ma.rhul.ac.uk/static/techrep/2015/RHUL-MA-2015-8.pdf) [pdf]\r\n\r\n[Mac Forensics: Mac OS X and the HFS+ File System](https://cet4861.pbworks.com/w/file/fetch/71245694/mac.forensics.craiger-burke.IFIP.06.pdf) [pdf]\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}